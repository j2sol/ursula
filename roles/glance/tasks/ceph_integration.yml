---
- name: fetch rados.py
  command: wget "{{ ceph.rados_url }}"
    args:
      chdir: /opt/openstack/current/glance/lib/python2.7/site-packages/
      creates: /opt/openstack/current/glance/lib/python2.7/site-packages/rados.py

- name: rados.py perms
  file:
    path: /opt/openstack/current/glance/lib/python2.7/site-packages/rados.py
    owner: root
    group: root
    mode: 0644

- name: fetch rbd.py
  command: wget "{{ ceph.rbd_url }}"
    args:
      chdir: /opt/openstack/current/glance/lib/python2.7/site-packages/
      creates: /opt/openstack/current/glance/lib/python2.7/site-packages/rbd.py

- name: rbd.py perms
  file::
    path: /opt/openstack/current/glance/lib/python2.7/site-packages/rbd.py
    owner: root
    group: root
    mode: 0644

- name: fetch glance keyring
  slurp: path=/etc/ceph/ceph.client.glance.keyring
  run_once: true
  delegate_to: "{{ groups['ceph_monitors'][0] }}"
  register: glance_keyring

- name: write glance keyring
  copy:
    dest: "{{ glance_keyring['source'] }}"
    content: "{{ glance_keyring['content'] | b64decode }}"
    mode: 0644
    owner: glance
    group: glance
